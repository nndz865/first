<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chat Simple</title>
    <style>
        :root{
            --bg:#f2f5f7; --accent:#2b8aef; --muted:#97a0a8; --me:#daf1ff; --you:#ffffff;
            --card:#ffffff;
            font-family: Inter, Roboto, "Segoe UI", Arial, sans-serif;
        }
        *{box-sizing:border-box}
        body{margin:0;height:100vh;background:var(--bg);display:flex;align-items:stretch;}
        .app{width:100%;max-width:1100px;margin:auto;display:flex;height:90vh;box-shadow:0 6px 24px rgba(10,20,30,0.08);border-radius:10px;overflow:hidden;background:linear-gradient(180deg,#fff,#fbfdff);}
        .sidebar{width:320px;background:var(--card);border-right:1px solid #e6eef5;display:flex;flex-direction:column}
        .sidebar .top{padding:16px;border-bottom:1px solid #eef5f9;display:flex;align-items:center;gap:12px}
        .brand{font-weight:700;color:var(--accent);font-size:18px}
        .search{padding:10px 12px;margin:10px;border-radius:10px;background:#f3f7fb;border:1px solid #e6eef5}
        .contacts{overflow:auto;padding:8px}
        .contact{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;cursor:pointer}
        .contact:hover{background:#f6fbff}
        .avatar{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
        .meta{flex:1;min-width:0}
        .name{font-weight:600}
        .preview{font-size:13px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .time{font-size:12px;color:var(--muted)}
        .main{flex:1;display:flex;flex-direction:column;background:linear-gradient(180deg,#eef9ff,#ffffff)}
        .chat-header{display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid #eef6fb;gap:12px}
        .chat-header .title{font-weight:700}
        .messages{flex:1;overflow:auto;padding:20px;display:flex;flex-direction:column;gap:12px}
        .msg-row{display:flex;gap:10px;align-items:flex-end;max-width:75%}
        .msg-row.me{align-self:flex-end;flex-direction:row-reverse}
        .bubble{padding:10px 14px;border-radius:14px;background:var(--you);box-shadow:0 1px 0 rgba(0,0,0,0.03);font-size:14px;line-height:1.3}
        .msg-row.me .bubble{background:var(--me)}
        .msg-meta{font-size:11px;color:var(--muted);margin-top:6px;text-align:right}
        .input-area{padding:12px;border-top:1px solid #eef6fb;display:flex;gap:8px;align-items:center}
        .input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #dfecef;background:white}
        .btn{background:var(--accent);color:white;padding:10px 12px;border-radius:10px;border:none;cursor:pointer}
        .centered{margin:auto; text-align:center; color:var(--muted)}
        @media (max-width:800px){
            .sidebar{display:none}
            .app{height:100vh;border-radius:0}
        }
    </style>
</head>
<body>
    <div class="app" id="app">
        <div class="sidebar">
            <div class="top">
                <div class="brand">ChatSimple</div>
            </div>
            <div style="padding:8px">
                <input id="search" class="search" placeholder="Cari kontak..." />
            </div>
            <div class="contacts" id="contacts"></div>
        </div>

        <div class="main">
            <div class="chat-header" id="chatHeader">
                <div style="display:flex;align-items:center;gap:12px">
                    <div id="chatAvatar" class="avatar" style="background:#7b9cff">A</div>
                    <div>
                        <div class="title" id="chatName">Pilih kontak</div>
                        <div id="chatStatus" class="preview">Status tidak tersedia</div>
                    </div>
                </div>
            </div>

            <div class="messages" id="messages">
                <div class="centered">Pilih kontak di kiri untuk memulai obrolan.</div>
            </div>

            <div class="input-area">
                <input id="messageInput" class="input" placeholder="Ketik pesan..." disabled />
                <button id="sendBtn" class="btn" disabled>Kirim</button>
            </div>
        </div>
    </div>

    <script>
        // Simple chat app (client-side only) with localStorage persistence.
        const defaultContacts = [
            {id: 'c1', name: 'Siti', color:'#ff7b7b', status:'Online'},
            {id: 'c2', name: 'Andi', color:'#7b9cff', status:'Terakhir dilihat 2 jam lalu'},
            {id: 'c3', name: 'Rina', color:'#ffd27b', status:'Sedang sibuk'},
            {id: 'c4', name: 'Team', color:'#7bd389', status:'Grup kerja'}
        ];

        const STORAGE_KEY = 'chat_simple_data_v1';

        let state = {
            contacts: [],
            selected: null,
            data: {} // messages per contact id
        };

        function loadState(){
            try{
                const raw = localStorage.getItem(STORAGE_KEY);
                if(raw) state = JSON.parse(raw);
                else {
                    state.contacts = defaultContacts;
                    state.data = {};
                    defaultContacts.forEach(c => state.data[c.id] = [
                        {from:'them', text: `Halo, saya ${c.name}.`, time: Date.now()-1000*60*60}
                    ]);
                    saveState();
                }
            }catch(e){
                console.error(e);
            }
        }

        function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

        // DOM
        const contactsEl = document.getElementById('contacts');
        const messagesEl = document.getElementById('messages');
        const chatNameEl = document.getElementById('chatName');
        const chatStatusEl = document.getElementById('chatStatus');
        const chatAvatarEl = document.getElementById('chatAvatar');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const searchInput = document.getElementById('search');

        function renderContacts(filter=''){
            contactsEl.innerHTML = '';
            const list = state.contacts.filter(c => c.name.toLowerCase().includes(filter.toLowerCase()));
            list.forEach(c => {
                const last = (state.data[c.id] || []).slice(-1)[0];
                const div = document.createElement('div');
                div.className = 'contact';
                div.dataset.id = c.id;
                div.innerHTML = `
                    <div class="avatar" style="background:${c.color}">${c.name.charAt(0).toUpperCase()}</div>
                    <div class="meta">
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <div class="name">${c.name}</div>
                            <div class="time">${last ? formatTime(last.time) : ''}</div>
                        </div>
                        <div class="preview">${last ? (last.from==='me' ? 'Anda: ' : '') + last.text : c.status}</div>
                    </div>
                `;
                div.addEventListener('click', ()=> selectContact(c.id));
                contactsEl.appendChild(div);
            });
        }

        function selectContact(id){
            state.selected = id;
            saveState();
            const c = state.contacts.find(x=>x.id===id);
            chatNameEl.textContent = c.name;
            chatStatusEl.textContent = c.status;
            chatAvatarEl.textContent = c.name.charAt(0).toUpperCase();
            chatAvatarEl.style.background = c.color;
            messageInput.disabled = false;
            sendBtn.disabled = false;
            renderChat();
            highlightSelected();
        }

        function highlightSelected(){
            Array.from(document.querySelectorAll('.contact')).forEach(el=>{
                el.style.background = (el.dataset.id === state.selected) ? '#eef8ff' : '';
            });
        }

        function renderChat(){
            messagesEl.innerHTML = '';
            const msgs = state.data[state.selected] || [];
            if(msgs.length===0){
                messagesEl.innerHTML = '<div class="centered">Belum ada pesan. Mulai percakapan!</div>';
                return;
            }
            msgs.forEach(m=>{
                const row = document.createElement('div');
                row.className = 'msg-row ' + (m.from==='me' ? 'me' : 'them');
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.innerHTML = `<div>${escapeHtml(m.text)}</div><div class="msg-meta">${formatTime(m.time)}</div>`;
                row.appendChild(bubble);
                messagesEl.appendChild(row);
            });
            // scroll to bottom
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function sendMessage(){
            const text = messageInput.value.trim();
            if(!text || !state.selected) return;
            const msg = {from:'me', text, time: Date.now()};
            state.data[state.selected] = state.data[state.selected] || [];
            state.data[state.selected].push(msg);
            saveState();
            renderContacts(searchInput.value);
            renderChat();
            messageInput.value = '';
            // fake auto reply after 1s
            setTimeout(()=> {
                const reply = {from:'them', text: autoReply(), time: Date.now()};
                state.data[state.selected].push(reply);
                saveState();
                renderContacts(searchInput.value);
                renderChat();
            }, 1000 + Math.random()*1000);
        }

        function autoReply(){
            const samples = [
                "Oke, noted.",
                "Baik.",
                "Siap!",
                "Terima kasih.",
                "Bisa kita bicarakan nanti?",
                "Saya cek dulu ya."
            ];
            return samples[Math.floor(Math.random()*samples.length)];
        }

        function formatTime(ts){
            const d = new Date(ts);
            const now = new Date();
            const sameDay = d.toDateString() === now.toDateString();
            const hh = d.getHours().toString().padStart(2,'0');
            const mm = d.getMinutes().toString().padStart(2,'0');
            return sameDay ? `${hh}:${mm}` : d.toLocaleDateString();
        }

        function escapeHtml(s){
            return s.replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
        }

        // Events
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', e=>{
            if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
        });
        searchInput.addEventListener('input', ()=> renderContacts(searchInput.value));

        // Initialize
        loadState();
        renderContacts();
        if(state.selected) selectContact(state.selected);
    </script>
</body>
</html></html>